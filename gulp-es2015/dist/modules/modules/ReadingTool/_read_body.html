<!-- 朗读文本 -->
<div class="readtool_wrap scrollbar_style_white">
    <!-- 工具栏 -->
    <div class="ndui-tool readtool-middle">
        <!-- 侧边按钮 -->
        <div class="ndui-tool-box clearfix">
            <ul class="ndui-tool-list left">
                <li class="ndui-tool-cell">
                    <a href="javascript:;" class="ndui-btn-readtool btn-read-play">
                        <i class="ndui-btn-pic"></i>
                        <em class="ndui-btn-txt"></em>
                    </a>
                </li>
            </ul>
            <ul class="ndui-tool-list right">
                <li class="ndui-tool-cell">
                    <a href="javascript:;" class="ndui-btn-readtool btn-read-pause">
                        <i class="ndui-btn-pic"></i>
                        <em class="ndui-btn-txt"></em>
                    </a>
                </li>
            </ul>                
        </div>
        <!-- 其他操作按钮 -->
        <div class="ndui-tool-box-other">
            <!-- 可注入的滚动条 -->
            <div class="tool_scrollbar_bothside">
                <div class="tool_scrollbar left">
                    <div class="scrollbar_wrap">
                        <div class="scrollbar_thumb"></div>
                    </div>
                </div>
                <div class="tool_scrollbar right">
                    <div class="scrollbar_wrap">
                        <div class="scrollbar_thumb"></div>
                    </div>
                </div>
            </div>
        </div>
        <!-- 其他操作按钮 -->            
    </div>
    <div class="readtool_article">
        <!-- 若需要标题与作者上下行显示，加class: second_line -->
        <div class="rdtl_arit_title">
            <em class="title">荷塘月色</em>
            <em class="author">(朱自清)</em>
        </div>
        <div class="rdtl_arit_para ui_btn_active">
            <div class="rdtl_sentence_wrap ">
                <p class="rdtl_arit_sentence">
                    <span class="txt">这几天心里颇不宁静天心里颇不宁。</span>
                </p>
                <p class="rdtl_arit_sentence active">
                    <span class="txt">
                        今晚在院子里坐着乘凉，忽然想起日日走过的荷<em class="new">塘</em>，在这满月的光里，总该另有一番样子吧。
                    </span>
                </p>
                <p class="rdtl_arit_sentence" >
                    <span class="txt">
                        月亮渐渐地升高了亮渐渐地升高了渐渐地升高了，<em class="new">墙</em>外马路上孩子们的。
                    </span>
                </p>
                <p class="rdtl_arit_sentence">
                    <span class="txt">这几天心里颇不宁静。</span>
                </p>
                <p class="rdtl_arit_sentence">
                    <span class="txt">
                        月亮渐渐地升高了22，<em class="new">墙</em>外马路上孩子们的。
                    </span>
                </p>
                <!-- 在每一个段落后边，再插入一个<i class="count"></i>， 方便计算句子末的位置 -->
                <i class="count"></i>
            </div>
            <div class="rdtl_sign_cover">
                <div class="rdtl_sign_cover_wrap">
                    <!-- 动态插入覆盖框 -->
                    <!-- <p class="rdtl-sign-cover-strip top"></p>
                    <p class="rdtl-sign-cover-strip middle"></p>
                    <p class="rdtl-sign-cover-strip middle"></p>
                    <p class="rdtl-sign-cover-strip bottom"></p> -->
                </div>
            </div>
        </div>
        <div class="rdtl_arit_para">
            <div class="rdtl_sentence_wrap">
                <p class="rdtl_arit_sentence">
                    <span class="txt">这几天心里颇不宁静天心里颇不宁。</span>
                </p>
                <p class="rdtl_arit_sentence">
                    <span class="txt">
                        今晚在院子里坐着乘凉，忽然想起日日走过的荷<em class="new">塘</em>，在这满月的光里，总该另有一番样子吧。
                    </span>
                </p>
                <p class="rdtl_arit_sentence" >
                    <span class="txt">
                        月亮渐渐地升高了亮渐渐地升高了渐渐地升高了，<em class="new">墙</em>外马路上孩子们的。
                    </span>
                </p>
                <p class="rdtl_arit_sentence">
                    <span class="txt">这几天心里颇不宁静。</span>
                </p>
                <p class="rdtl_arit_sentence">
                    <span class="txt">
                        月亮渐渐地升高了22，<em class="new">墙</em>外马路上孩子们的。
                    </span>
                </p>
                <!-- 在每一个段落后边，再插入一个<i class="count"></i>， 方便计算句子末的位置 -->
                <i class="count"></i>
            </div>
            <div class="rdtl_sign_cover">
                <div class="rdtl_sign_cover_wrap">
                    <!-- 动态插入覆盖框 -->
                </div>
            </div>
        </div>
        <div class="rdtl_arit_para">
            <div class="rdtl_sentence_wrap">
                <p class="rdtl_arit_sentence">
                    <span class="txt">这几天心里颇不宁静天心里颇不宁。</span>
                </p>
                <p class="rdtl_arit_sentence isreading">
                    <span class="txt">
                        今晚在院子里坐着乘凉，忽然想起日日走过的荷<em class="new">塘</em>，在这满月的光里，总该另有一番样子吧。
                    </span>
                </p>
                <p class="rdtl_arit_sentence" >
                    <span class="txt">
                        月亮渐渐地升高了亮渐渐地升高了渐渐地升高了，<em class="new">墙</em>外马路上孩子们的。
                    </span>
                </p>
                <p class="rdtl_arit_sentence">
                    <span class="txt">这几天心里颇不宁静。</span>
                </p>
                <p class="rdtl_arit_sentence">
                    <span class="txt">
                        月亮渐渐地升高了22，<em class="new">墙</em>外马路上孩子们的。
                    </span>
                </p>
                <i class="count"></i>
            </div>
            <div class="rdtl_sign_cover">
                <div class="rdtl_sign_cover_wrap">
                    <!-- 动态插入覆盖框 -->
                </div>
            </div>
        </div>
    </div>
</div>
<script src="http://www.w3school.com.cn/jquery/jquery-1.11.1.min.js"></script>
<script>
// 增加字框的方法
function addSentenceCover(self,rows){
    if (!self || !rows) {
        console.log("添加句子覆盖边框——参数有误");
        return false;
    }

    var layoutSize =  parseFloat($('#layout').css('font-size'))

    var senLeft = self[0].offsetLeft - 14/24*layoutSize
    var senTop = self[0].offsetTop

    var wrapWidth = self.parents('.rdtl_arit_para')[0].offsetWidth

    var senNextLeft = self.next()[0].offsetLeft
    if (senNextLeft == 0) {
        senNextLeft = wrapWidth + 14/24*layoutSize
    }else {
        senNextLeft -= 14/24*layoutSize
    }

    
    // append 覆盖框
    var topStr = '<p class="rdtl_sign_cover_strip top"></p>'
    var middleStr = '<p class="rdtl_sign_cover_strip middle"></p>'
    var bottomStr = '<p class="rdtl_sign_cover_strip bottom"></p>'
    var coverStr = ''
    switch(rows){
        case 1:
            coverStr = topStr
        break
        case 2:
            coverStr = topStr + bottomStr
        break
        // 不少于3行
        default:
            coverStr = topStr
            for (var i = 2 ; i < rows ; i++) {
                coverStr = coverStr + middleStr
            }
             coverStr = coverStr + bottomStr
        break
    }
    var coverWrap = self.parents('.rdtl_arit_para').find('.rdtl_sign_cover_wrap')
    coverWrap.html(coverStr)
    // 定位
    coverWrap.css({
        top: senTop + 'px'
    })
    if (rows === 1) {
        coverWrap.find('.rdtl_sign_cover_strip.top').css({
            width: 'auto',
            left: senLeft + 'px',
            right: wrapWidth - senNextLeft + 'px'
        })
    }else {
        coverWrap.find('.rdtl_sign_cover_strip.top').css({
            width: 'auto',
            left: senLeft + 'px',
            right: '0'
        })
        coverWrap.find('.rdtl_sign_cover_strip.bottom').css({
            width: 'auto',
            left: '0',
            right: wrapWidth - senNextLeft + 'px'
        })
    }
}
// 清除cover
function clearSentenceCover(self){
    var coverWrap = self.parents('.rdtl_arit_para').find('.rdtl_sign_cover_wrap')
    coverWrap.html('')
}
// 触发事件
$('.layout_full .rdtl_arit_para .rdtl_arit_sentence, .layout_window .rdtl_arit_para .rdtl_arit_sentence').on('click', function(event) {
    var self = $(this)
    clearSentenceCover($('.rdtl_arit_para .rdtl_arit_sentence'));
    var index = self.index('.rdtl_arit_sentence')
    var totalSentence = self.parents('.rdtl_arit_para').find('.rdtl_arit_sentence').length
    var txtHeight = self.find('.txt').height()
    var txtLineHeight =  parseFloat($('.txt').css('line-height'))
    var rows = Math.ceil(txtHeight/txtLineHeight)
    // 改变字体颜色
    $('.rdtl_arit_sentence').removeClass('ui_btn_active')
    self.addClass('ui_btn_active')

    addSentenceCover(self,rows)
})
// 滚动方案
var article = new Article($('.readtool_wrap'), $('.readtool_article'));

article.updatePos();

function Article(wrapDom, cntDom){
    var self = this;
    self.scrollTop = 0;
    self.speed = 100;
    self.wrapHeight = wrapDom.outerHeight();
    self.cntHeight = cntDom.outerHeight();
    setTimeout(function(){  
        self.cntHeight = cntDom.outerHeight();
        console.log("文本容器高度："+self.wrapHeight);
        console.log("文本高度："+self.cntHeight);
        self.totleScrollDisTance = self.cntHeight;
        self.SetScrollStyle();
        self.scrollHeight = $('.scrollbar_wrap').outerHeight();
        self.scrollThumbHeight = $('.scrollbar_thumb').outerHeight();
        console.log("滚动条容器高度："+self.scrollHeight);
        console.log("滚动条滑块高度："+self.scrollThumbHeight);
    }, 1000)
    
    

    self.SetScrollStyle = function(){
        $('.scrollbar_wrap .scrollbar_thumb').css({
            height: self.wrapHeight/(self.cntHeight+self.wrapHeight/2)*100 +'%'
        });
    }
    self.updatePos = function (){
        if (self.scrollTop < self.totleScrollDisTance) {
            self.scrollTop += 1;
            $('.layout_full .readtool_article, .layout_window .readtool_article').css({
                transform: 'translateY(-' + self.scrollTop + 'px)'
            });
            // var sss = 
            $('.layout_full .scrollbar_wrap .scrollbar_thumb, .layout_window .scrollbar_wrap .scrollbar_thumb').css({
                transform: 'translateY(' + self.scrollTop/self.cntHeight*(self.scrollHeight - self.scrollThumbHeight) + 'px)'
            });
        }
        setTimeout(function(){
            self.updatePos();
        }, self.speed)
        
    }
}
</script>